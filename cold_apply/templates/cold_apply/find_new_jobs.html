{% extends 'base_app.html' %}
{% load form_helpers %}

{% block breadcrumbs %}
    {% breadcrumb 'Pipeline' 'cold_apply:index' %}
    {% breadcrumb participant.full_name 'cold_apply:participant_detail' participant.id %}
    {% breadcrumb 'Job Search' %}
{% endblock breadcrumbs %}

{% block content %}
<div class="row">
    <div class="col-lg-6">
        <form action="" method="post">
        <h4>New Job Search</h4>
            <p>Set search parameters</p>
            
            {% csrf_token %}
            {% for field in form %}
                {% include 'cold_apply/templates/form_input_template.html' %}
            {% endfor %}
            <div class="row">
            <div class="col-3">
                Search Radius
            </div>
                <div class="col-3">30 miles (48km)</div>
            </div>
            <div class="text-end">
                <a href="{% url 'cold_apply:participant_detail' participant.id %}" class="btn btn-outline-primary">Cancel</a>
                <input class="btn btn-primary" type="submit" value="Search">
            </div>
        </form>
    </div>
    <div class="col-lg-6">
        <h4>Applicant Information</h4>
        {% if applicant %}
        <div class="row mb-2">
            <div class="col-3">Location:</div>
            <div class="col-9">
                {{participant.location}}
            </div>
        </div>
        <div class="row mb-2">
            <div class="col-3">Specialist Training:</div>
            <div class="col-9">
                {{applicant.special_training}}
            </div>
        </div>
        <div class="row mb-2">
            <div class="col-3">Specialist Skills:</div>
            <div class="col-9">
                {{applicant.special_skills}}
            </div>
        </div>
        <div class="row mb-2">
            <div class="col-3">Work Preferences</div>
            <div class="col-9">
                {{applicant.work_preferences}}
            </div>
        </div>
        <div class="row mb-2">
            <div class="col-3">Service Branch:</div>
            <div class="col-9">
                {{applicant.service_branch}}
            </div>
        </div>
        <div class="row mb-2">
            <div class="col-3">Military Specialiaty:</div>
            <div class="col-9">
                {{applicant.military_specialiaty}}
            </div>
        </div>
        {% else %}
            <p>Application data not found.</p>
        {% endif %}
    </div>
</div>

<div class="row">
    <div class="col">
        <h3>Recent Search history</h3>
        <table class="table table-striped border" style="table-layout: fixed;">
            <thead>
                <thead>
                    <tr>
                        <th>Start Time</th>
                        <th>Jobs Found</th>
                        <th>Duplicate Count</th>
                        <th>Search Query</th>
                        <th>Keywords</th>
                        <th>Date Posted</th>
                        <th>Search Radius</th>
                        <th>Run By</th>
                    </tr>
                </thead>
            </thead>
            <tbody>
                {% for search in job_searches %}
                    <tr>
                        <td>{{search.created_at|date:'d/m/y H:i:s'}}</td>
                        <td>{{search.result_count}}</td>
                        <td>{{search.duplicate_count}}</td>
                        <td>{{search.search_query}}</td>
                        <td>{{search.keywords_csv}}</td>
                        <td>{{search.date_posted}}</td>
                        <td>{{search.distance_miles}}</td>
                        <td>{{search.run_by}}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock content %}